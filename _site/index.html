<!DOCTYPE html>
<html>
    <head>
        
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Roboto+Mono:400,500" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.4/css/materialize.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/themes/prism.min.css">
        
        <style>
            ul:not(.section){
                margin: 2px 0 !important;
                padding:6px;
                padding-left: 20px !important;
            }
            ul:not(.section) li {
                list-style: !important;
                padding: 8px;
            }
            ul:not(.section) li:not(:last-child){
                /*border-bottom: 1px solid rgba(0,0,0,0.15);*/
            }

            code{
                background: rgba(0,0,0,0.1);
                font-family: "Roboto Mono", monospace;
            }
            blockquote p {
                margin: 0;
            }
            .card-title code{
                /* background: transparent; */
            }
            figure.highlight{
                margin: 0;
            }
            table.tabbed{
                margin-left:20px;
            }
            table th {
                color: rgba(0,0,0,0.54);
                font-size:12.5px;
                font-weight: 500;
            }
            code[class*=language-], pre[class*=language-]{
                font-family: "Roboto Mono", monspace;
            }
        </style>
    </head>

    <body>
        <div class="container">
            <div class="row">
                <div class="col hide-on-small-only m4 l3">
                    <div id="sidebar">
                        <ul class="section table-of-contents">
                            
                            <li><a href="#introduction">Introduction</a></li>
                            
                            <li><a href="#basic-example">Basic example</a></li>
                            
                            <li><a href="#basic-stream-example">Basic stream example</a></li>
                            
                            <li><a href="#api-docs">API docs</a></li>
                            
                            <li><a href="#streams">Streams</a></li>
                            
                            <li><a href="#static-properties-and-methods">Static properties and methods</a></li>
                            
                        </ul>
                        <a href="https://github.com/irontiga/wimp-js/" class="btn-flat waves-effect waves-red red-text text-lighten-2" target="_blank">Github<i class="material-icons right">launch</i></a>
<br><br>
<a href="https://github.com/irontiga/wimp-js/releases/download/v0.1.1/wimp.js" class="waves-effect waves-light red lighten-2 btn-flat white-text" target="_blank">Download<i class="material-icons right">cloud_download</i></a>
<br>
<i class="grey-text text-lighten-1">wimp.js v0.1.1 </i>
                    </div>
                </div>
                <div class="col s12 m8 l9">
                    <div class="hide-on-med-and-up">
                        <a href="https://github.com/irontiga/wimp-js/" class="btn-flat waves-effect waves-red red-text text-lighten-2" target="_blank">Github<i class="material-icons right">launch</i></a>
<br><br>
<a href="https://github.com/irontiga/wimp-js/releases/download/v0.1.1/wimp.js" class="waves-effect waves-light red lighten-2 btn-flat white-text" target="_blank">Download<i class="material-icons right">cloud_download</i></a>
<br>
<i class="grey-text text-lighten-1">wimp.js v0.1.1 </i>
                    </div>
                    <br>
<h2>Wimp.js</h2>
<h6>Making window.postMessage practical and pleasurable</h6>
<br>

<h4 id="introduction">Introduction</h4>
Wimp's goal is to make window.postMessage easy and viable. It's inspired by both HTTP and websockets, making it familiar (hopefully) to web developers. 

<h4 id="installation">Installation</h4>
Just include a script tag in your html

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"wimp.js"</span><span class="nt">&gt;&lt;/script&gt;</span></code></pre></figure>

<h4 id="basic-example">Basic example</h4>
In this example we're going to have index.html fetch the height of an iframe via a request. Note that this is an example, and far from the best way to do it (you could do it better with or without Wimp).
<br>
<b>index.html</b>
<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;iframe</span> <span class="na">src=</span><span class="s">"iframe1.html"</span> <span class="na">id=</span><span class="s">"frame1"</span><span class="nt">&gt;&lt;/iframe&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"wimp.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="nx">Wimp</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span> <span class="c1">// Listens for messages. Needs to be called BEFORE the outgoing request is made (or else you can risk missing the response message)</span>

        <span class="kd">const</span> <span class="nx">frame1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wimp</span><span class="p">(</span><span class="s2">"#frame1"</span><span class="p">)</span> <span class="c1">// Initialze a new Wimp, which will be able to cumminicate with #frame1</span>

        <span class="nx">frame1</span><span class="p">.</span><span class="nx">ready</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// Wait for the ready promise to fulfill, in order to assure that the target is ready to start receiving requests</span>
            <span class="nx">frame1</span><span class="p">.</span><span class="nx">request</span><span class="p">(</span><span class="s2">"height"</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">req</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"frame1"</span><span class="p">).</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">data</span> <span class="c1">// The data sent by frame1 is stored under req.data</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span></code></pre></figure>
<b>frame1.html</b>
<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>
    ...
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"wimp.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">const</span> <span class="nx">container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wimp</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">)</span> <span class="c1">// Can also take a window object</span>

        <span class="c1">// Defines a "height" route. On a "height" request it will pass both the request and a response function to your callback.</span>
        <span class="nx">container</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"height"</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">)</span>
        <span class="p">})</span>
        
        <span class="nx">Wimp</span><span class="p">.</span><span class="nx">init</span><span class="p">()</span> <span class="c1">// Init should be called AFTER any routes are defined</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span></code></pre></figure>
<a href="demo/basic/" target="_blank">See this example live</a>

<h4 id="basic-stream-example">Basic stream example</h4>
Now we're going to build a simple counter. Our iframe will send a stream message out whenever a button is clicked.
<strong>index.html</strong>
<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;h1</span> <span class="na">id=</span><span class="s">"counterValue"</span><span class="nt">&gt;&lt;/h1&gt;</span>

    <span class="nt">&lt;iframe</span> <span class="na">id=</span><span class="s">"frame1"</span> <span class="na">src=</span><span class="s">"frame1.html"</span><span class="nt">&gt;&lt;/iframe&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"wimp.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="nt">&lt;script&gt;</span>
        <span class="nx">Wimp</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span> <span class="c1">// Init is called BEFORE any outgoing wimp requests or listeners</span>

        <span class="nx">counterValue</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"counterValue"</span><span class="p">);</span>

        <span class="kd">const</span> <span class="nx">counterWimp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wimp</span><span class="p">(</span><span class="s2">"#frame1"</span><span class="p">)</span>

        <span class="nx">counterWimp</span><span class="p">.</span><span class="nx">ready</span><span class="p">().</span><span class="nx">then</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">counterWimp</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="nx">counterValue</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">count</span><span class="p">;</span>
            <span class="p">})</span>
        <span class="p">})</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span></code></pre></figure>
<strong>frame1.html</strong>
<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;body&gt;</span>

    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"counter"</span><span class="nt">&gt;</span>Count + 1<span class="nt">&lt;/button&gt;</span>

    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"wimp.js"</span><span class="nt">&gt;&lt;/script&gt;</span>

    <span class="nt">&lt;script&gt;</span>
        <span class="kd">let</span> <span class="nx">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="nx">buttonStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wimp</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">).</span><span class="nx">createStream</span><span class="p">(</span><span class="s2">"click"</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">(</span><span class="nx">counter</span><span class="p">);</span>
        <span class="p">})</span>
        
        <span class="nx">Wimp</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span> <span class="c1">// Note that init is called AFTER the stream has been defined</span>

        <span class="kd">const</span> <span class="nx">counterButton</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">"counter"</span><span class="p">);</span>

        <span class="nx">counterButton</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
            <span class="nx">counter</span><span class="o">++</span><span class="p">;</span>
            <span class="nx">buttonStream</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="nx">counter</span><span class="p">);</span>
        <span class="p">}</span>
        
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span></code></pre></figure>
<a href="demo/basic-stream/" target="_blank">See this example live</a>
<h4 id="api-docs">API docs</h4>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>const myWimp = new Wimp(target [, proxy])</code></span>
        Creates a new Wimp instance for cross frame communication.
        <blockquote>
            <p><b><code>target</code></b> - The iframe/window we're communicating with. Can be any of the following, or an array of any number of the following.</p>
            <table class="tabbed">
                <tbody>
                    <tr>
                        <th>Query selector</th>
                        <td><code>String</code></td>
                        <td>e.g. <code>"#frame1"</code></td>
                    </tr>
                    <tr>
                        <th>Content window</th>
                        <td><code>Object</code></td>
                        <td>e.g. <code>window.parent</code> or <code>document.getElementByID("#frame1").contentWindow</code>. Can not be used in conjuction with <code>proxy</code></td>
                    </tr>
                    <tr>
                        <th><code>"*"</code> - Wildcard</th>
                        <td><code>String</code></td>
                        <td><code>Uses `window.frames`. Note that new iframes will not automatically be added.</code></td>
                    </tr>
                    <tr>
                        <th>Registered target</th>
                        <td><code>String</code></td>
                        <td>A preregistered iframe's name. See **LINK ME UP BOIIIII**</td>
                    </tr>
                    <tr>
                        <th><code>Object</code></th>
                        <td><code>Object</code></td>
                        <td>Can be an object like <code>{selector: "#frame1", origin: "mydomain.com"}</code>, where selector can be any of the above.</td>
                    </tr>
                </tbody>
            </table>
        </blockquote>
        
        <blockquote>
            <p><b><code>proxy</code></b> - If included, requests etc. will be sent through the proxy and to the target within it's DOM. It's the same as target, however when proxying is enabled, target can not be a content window.</p>
        </blockquote>
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>myWimp.ready(fn)</code></span>
        Called when <code>Wimp.init()</code> has been called in all this Wimp instance's targets.
        <blockquote>
            <p><b><code>fn</code></b> - <code>Function</code> - Function called when all the targets are ready. Can also be omiited and then a promise will be returned, which will resolve when all the targets are ready.</p>
        </blockquote>
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>myWimp.request(request [, options, callback])</code></span>
        Sends a request, much like a HTTP GET/POST request
        <blockquote>
            <p><b><code>request</code></b> - <code>String</code> - The request string you're trying to make. Think of it as a URL.</p>
        </blockquote>
        
        <blockquote>
            <p><b><code>options</code></b> - <code>Object</code> Specifies options for the request. Can be omitted.</p>
            <table class="tabbed">
                <tbody>
                    <tr>
                        <th>Request</th>
                        <td>Request can also be omitted and defined within options</td>
                    </tr>
                    <tr>
                        <th>expectResponse</th>
                        <td><code>Boolean</code> - Default: <code>true</code>. If <code>false</code> callback will not be called. Makes the request one way.</td>
                    </tr>
                    <tr>
                        <th>data</th>
                        <td>Data to be sent with the request. Can be anything, but note that it will go through <code>JSON.stringify</code> and then <code>JSON.parse</code></td>
                    </tr>
                </tbody>
            </table>
        </blockquote>

        <blockquote>
            <p><b><code>callback(response)</code></b> - <code>Function</code> Optional - called when the request completes. `data` is the response which the request receives. If omitted a promise will be returned instead. <code>response</code> is an object containing the following. <code>.then((response) => {})</code> is identical.</p>
            <table class="tabbed">
                <tbody>
                    <tr>
                        <th>success</th>
                        <td><code>Boolean</code> - <code>true</code> if the request was successful, <code>false</code> if not</td>
                    </tr>
                    <tr>
                        <th>data</th>
                        <td><code>Any</code> - The received data from the request. This is exactly what is supplied by <code>res(someData)</code> from the route (<code>myWimp.on(...)</code>)</td>
                    </tr>
                    <tr>
                        <th>requestID</th>
                        <td>The request's ID. Can be treated as unique</td>
                    </tr>
                    <tr>
                        <th>error.message</th>
                        <td>If success is false an error message will be specified here.</td>
                    </tr>
                </tbody>
            </table>
        </blockquote>
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>myWimp.on(request, fn)</code></span>
        Much like a server route. Receives a request with data(passed to fn), and replies (again with a function passed to fn).
        <blockquote>
            <p><b><code>request</code></b> - <code>String</code> - corresponds to the <code>request</code> coming from myWimp.request. </p>
        </blockquote>
        
        <blockquote>
            <p><b><code>fn(data, res)</code></b> - <code>Function</code> Called whenever a new request comes in.</p>
            <table class="tabbed">
                <tbody>
                    <tr>
                        <th>data</th>
                        <td>Data that came with the request. Already parsed</td>
                    </tr>
                    <tr>
                        <th><code>res(response), res.error(message)</code></th>
                        <td><code>Function</code> - Response function which sends <code>response</code> back to the client. Use <code>res.error(message)</code> in case of an error, with message being the error message.</td>
                    </tr>
                </tbody>
            </table>
        </blockquote>
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>myWimp.addTarget(target)</code></span>
        Adds a target to the instance of Wimp. Useful for example when trying to communicate with all frames AND a popup window.
<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">myWimp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Wimp</span><span class="p">(</span><span class="s2">"*); // All iframes
myWimp.addTarget(window.open("</span><span class="nx">popup</span><span class="p">.</span><span class="nx">html</span><span class="s2">")); // Add the popup window to the instance</span></code></pre></figure>
        <blockquote>
            <p><b><code>Target</code></b> - <code>Many</code> - Same as <code>new Wimp(target)</code>.</p>
        </blockquote>
    </div>
</div>

<h4 id="streams">Streams</h4>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>myStream = new Wimp("*").createStream(name [, options], joinFn)</code></span>
        Creates a new stream, much like a websocket.</code>
        <blockquote>
            <p><b><code>name</code></b> - <code>String</code> - Name of the stream (kinda like the URL) for client to connect to.</p>
        </blockquote>

        <blockquote>
            <p><b><code>options</code></b> - <code>Object</code> Optional options object. Specifies options for the stream.</p>
            <table class="tabbed">
                <tbody>
                    <tr>
                        <th>Name</th>
                        <td>Name can be omitted and specified in options instead. Has higher priority.</td>
                    </tr>
                    <tr>
                        <th>...</th>
                        <td><code>Function</code>...</td>
                    </tr>
                </tbody>
            </table>
        </blockquote>
        
        <blockquote>
            <p><b><code>joinFn(data, res)</code></b> - <code>Function</code> Called upon every new client connection</p>
            <table class="tabbed">
                <tbody>
                    <tr>
                        <th>data</th>
                        <td>Client can send data along with the connection request. This would be it</td>
                    </tr>
                    <tr>
                        <th><code>res(response)</code></th>
                        <td><code>Function</code> - Sends a response back to the client. This response will be treated exactly the same as <code>myStream.emit(response)</code>, but will only be sent to this particular client</td>
                    </tr>
                </tbody>
            </table>
        </blockquote>
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>myStream.emit(data)</code></span>
        Sends data to all clients connected to the stream.
        <blockquote>
            <p><b><code>data</code></b> - <code>Any</code> - Can be anything, but keep in mind that it will go through <code>JSON.stringify</code> and then <code>JSON.parse</code></p>
        </blockquote>
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>new Wimp("#frame1").listen(name, fn)</code></span>
        Connects to a stream.
        <blockquote>
            <p><b><code>name</code></b> - <code>String</code> - Corresponds to the name in <code>createStream(name...)</code></p>
        </blockquote>
        
        <blockquote>
            <p><b><code>fn(data)</code></b> - <code>Function</code> - Called whenever a new message is sent from the stream. Data is the...data.</p>
        </blockquote>
    </div>
</div>


<h4 id="static-properties-and-methods">Static properties and methods</h4>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>Wimp.init([selector])</code></span>
        Needs to be called in order to start listening for messages. (e.g. responses for requests and stream response). Should be called after any routes or streams are defined, but before any outgoing requests are made.
        <blockquote>
            <p><b><code>selector</code></b> - <code>Function</code> - You can replace the default query selector by passing a new one. Defaults to <code>document.querySelectorAll.bind(document)</code>. Can be handy for working with Polymer/shadow DOM</p>
        </blockquote>
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>Wimp.registerTarget(name, target)</code></span>
        Saves an iframe/popup with a name. Can be useful when using proxying. E.g. <code>Wimp.registerTarget("lovelyPopup", window.open(...))</code>, as this would be the only way to access the popup from outside of the window.
        <blockquote>
            <p><b><code>name</code></b> - <code>String</code> - Unique (within the window) identifier. The associated iframe/popup can then be accessed under this name.</p>
        </blockquote>
        <blockquote>
            <p><b><code>target</code></b> - <code>Many</code> - See <code>new Wimp(...)</code>, as this target is the same</p>
        </blockquote>
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>Wimp.proxy</code></span>
        Property. Defaults to <code>false</code>. When set to <code>true</code> will allow iframes and popups to use it as a proxy to talk to other iframes/popups within it's DOM.
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>Wimp.pendingRequest</code></span>
        <code>Object</code>. List of pending requests for all instances.
    </div>
</div>

<div class="card">
    <div class="card-content">
        <span class="card-title"><code>Wimp.registeredTargets</code></span>
        <code>Object</code>. List of registered targets.
    </div>
</div>


                </div>
            </div>
        </div>

            
            

        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-alpha.4/js/materialize.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/prism.min.js"></script>
        
        <script>
            $(document).ready(function(){
                $('.table-of-contents').scrollSpy();
                $('#sidebar').pushpin();
            });

        </script>
    </body>
</html>